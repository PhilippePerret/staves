# Animation pour analyse du
# premier prélude du CBT 1
# Mesures 1 - 11

# SUITE('CBT1_Prelude1_12-19')

# --- Valeurs par défault ---
DEFAULT('screensize', 610)
DEFAULT('next', 75)
DEFAULT('staff_top', 100)
DEFAULT('staff_offset', 140)
DEFAULT('caption_timer', true)
DEFAULT('decompte', 0)

# La partition complète
partition_complete = IMAGE({url:'asset/img/CBT1_Prelude_01/Partition/whole.png', x:126, y:60})


###CAPTION("Fort de ce rafraichissement tonal, nous allons pouvoir passer maintenant à un gros morceau de l'analyse musicale, l'analyse harmonique.", {wait:true})

###CAPTION("Cette analyse harmonique consiste à analyser tous les accords de la pièce, à déterminer leur fonction harmonique, à repérer toute forme de modulation et, très important, à mettre en exergue les cadences et leur type.", {wait:true})

###CAPTION("Pour cette initiation, on va procéder relativement lentement, et en détaillant, mais n'hésitez pas, encore une fois, à mettre la vidéo sur pause ou à revenir en arriève pour bien comprendre un passage qui serait aller trop vite.")

# --- Les portées ---
partition_complete.hide({duree:5})
NEW_STAFF(SOL)
NEW_STAFF(FA)
# La partition qui permet de suivre les mesures
partition=IMAGE({url:'asset/img/CBT1_Prelude_01/Harmony/longueur-01-14.png', y:279, x:73, inner_x:0, inner_y:0, cadre_width:267, cadre_height:96})

WAIT_CAPTION

###CAPTION("Si j'ai choisi cette pièce de Bach, c'est pour deux raisons principales. D'abord, elle est assez connue, et ensuite, son analyse harmonique est très simple, notamment parce qu'il n'y a qu'un seul accord par mesure, ce qui est somme toute assez rare.", {wait:true})

# --- Premier accord DO ---
ACTIVE_STAFF(1)
CAPTION("Commençons donc par l'accord de la première mesure.", {wait:true})
CAPTION("Dans un premier temps, je rassemble simplement ses notes en les superposant.")
STAFF(1).measure('1')
do1=CHORD('2:c4 e4 g4 c5 e5')
WAIT_CAPTION
CAPTION("Ensuite, je vais tenter d'arriver à un empilage de tierces qui me permettra de déterminer l'accord.",{wait:true})
CAPTION("Comme nous l'avons vu dans les premiers screencasts, un accord est en effet constitué de tierces superposées.", {wait:true})
CAPTION("Je vais donc déplacer les notes et supprimer les doublons, jusqu'à obtenir cet empilage de tierces. Ça n'est pas toujours simple au début, ça devient un jeu d'enfant avec l'habitude.")
WAIT(2)
STAFF(2).remove_supline({top:2})
do1.note(5).remove()
do1.note(1).move('1:c4', {duree:4})
STAFF(2).remove_supline({top:1})
do1.note(4).remove()
WAIT_CAPTION

CAPTION("Ici, j'obtiens donc les notes DO MI SOL, donc un accord de DO, puisque la note la plus basse est un DO. La quinte DO-SOL est juste. Et la tierce DO-MI est majeure, deux tons,…", {wait:true})
CAPTION("On se trouve donc en présence d'un accord de DO Majeur.")
do1.chord('C')
CAPTION('C = do', true)
WAIT_CAPTION

CAPTION("Dans une tonalité de DO Majeur, ce DO Majeur est donc l'accord de tonique, je le marque I en chiffre romain, sous la portée.")
do1.harmony('I')
WAIT_CAPTION

CAPTION("Un accord de tonique pour commencer le morceau, rien de bien original, c'est quasiment systématique dans la musique classique.")

# On remet l'accord en position
WAIT(1)
CHORD('c5 e5')


# --- Mesure 2 : accord Dm7 ---
WAIT_CAPTION
CAPTION("Passons maintenant à la deuxième mesure.", {wait:true})
CAPTION("Comme pour l'accord de DO, je cherche l'empilage de tierces et je supprime les doublons pour y voir plus clair.")
NEXT()
STAFF(1).measure('2')
partition.travelling({x:245})
rem1=CHORD('2:c4 d4 a4 d5 f5')
rem1.note(4).remove()
rem1.note(5).move('f4')
rem1.note(1).move('1:c5')
STAFF(2).remove_supline({top:1})

WAIT_CAPTION

CAPTION("J'obtiens les notes RÉ, FA LA DO, RÉ-LA un quinte juste, RÉ-FA une tierce mineure, RÉ-DO une septième mineure.", {wait:true})
CAPTION("J'ai donc un accord de RÉ mineur 7.")
rem1.chord('Dm7')
CAPTION('D = Ré / m = mineur / 7 = 7e mineure', true)
WAIT_CAPTION
CAPTION("À titre de rappel, quand on indique 7, il s'agit toujours d'une septième mineure, donc une note à un ton de la fondamentale de l'accord. Ici, DO est bien à un ton de RÉ, la septième majeure serait à un demi-ton, ce serait DO#.", {wait:true})

CAPTION("Cet accord est l'accord du deuxième degré de la tonalité de DO, puisque RÉ est la deuxième note de la gamme de DO.", {wait:true})
CAPTION("Je le marque donc II en chiffre romain suivi de 7 pour la septième, et j'ajoute au-dessus 3 points qui indique que cet accord est dans son état de troisième renversement.")
rem1.harmony('II7***')
WAIT_CAPTION

# --- Petite parenthèse sur les points ---
CAPTION("J'utilise ici la terminologie préconisée par Jacques Chailley, beaucoup plus claire et parlante que la notation harmonique par chiffrage qu'on utilise en cours d'harmonie, par exemple.", {wait:true})
CAPTION("C'est le troisième renversement, donc trois points, puisque dans la mesure nous trouvons la quatrième note de l'accord, le DO, à la basse. Un accord se trouve dans son état fondamental, lorsque la fondamentale est à la basse, comme pour le DO Majeur de la première mesure… ", {wait:true})
CAPTION("… Il se présente sous son premier renversement lorsque c'est la tierce, la deuxième note de l'accord, qui est la note la plus grave, sous son deuxième renversement lorsque c'est la quinte, donc la troisième note de l'accord qui est la note la plus grave, etc.", {wait:true})
CAPTION("Donc s'il n'y a pas de point, l'accord est dans son état fondamental, sinon il se présente sous un de ses renversements.")
# --- Fin petite parenthèse sur les points ---

# On le remet en position
WAIT(1)
rem1.note(5).move('f5')
rem1.note(1).move('c4')
NOTE('d5')

WAIT_CAPTION

# --- Mesure 3 : Sol7• ---
NEXT()
CAPTION("Passons à la troisième mesure.")
STAFF(1).measure('3')
partition.travelling({x:435})
sol1 = CHORD('2:b3 d4 g4 d5 f5')
WAIT_CAPTION
CAPTION("J'établis l'empilage des tierces.")
WAIT(2)
sol1.note(2).hide()
sol1.note(1).move('1:b4')
STAFF(2).remove_supline({top:1})
WAIT_CAPTION

### ==== J'EN SUIS ICI ===
#!START

sol1.chord('G7')
CAPTION('G = Sol / 7 = 7e mineure', true)
WAIT(1)
sol1.harmony('V7*')
# On le remet en position
WAIT(1)
sol1.note(1).move('b3')
sol1.note(2).show()

# --- Mesure 4 : Do ---
NEXT()
STAFF(1).measure('4')
partition.move({x:322}).travelling({x:584})
do2=CHORD('2:c4 e4 g4 c5 e5')
WAIT(4)
do2.note(1).move('1:c4')
STAFF(2).remove_supline({top:[1,2]})
do2.chord('C')
WAIT(1)
do2.cadence('I', {width:200, type:imparfaite})

# --- Mesure 5 : LAm ---
NEXT()
STAFF(1).measure('5')
partition.travelling({x:739})
lam = CHORD('2:c4 2:e4 a4 e5 a5')
WAIT(2)
lam.note(2).remove()
lam.note(1).move('1:c5')
STAFF(2).remove_supline({top:[1,2]})
lam.note(5).remove()
STAFF(1).remove_supline({top:1})
WAIT(1)
lam.chord('Am')
CAPTION("A = La / m = mineur", true)
WAIT(1)
lam.harmony('VI*')
# On le remet en position
WAIT(1)
lam.note(1).move('c4')
CHORD('e4 a5')

# --- Mesure 6 : D7 ---
NEXT()
STAFF(1).measure('6')
partition.travelling({x:891})
res = CHORD('2:c4 2:d4 fd4 a4 d5')
WAIT(2)
res.note(5).remove()
res.note(1).move('1:c5')
res.note(2).move('1:d4')
STAFF(2).remove_supline({top:1})
WAIT(1)
res.chord('D7')
WAIT(1)
res.note(3).exergue(red)
res.modulation('Sol [Dom.]')
res.harmony('V*')
res.note(3).unexergue()
WAIT(1)
res.note(1).move('c4')
NOTE('d5')

# --- Mesure 7 : G ---
NEXT()
STAFF(1).measure('7')
partition.travelling({x:1053})
acc = CHORD('2:b3 2:d4 g4 d5 g5')
acc.note(2).remove()
acc.note(1).move('1:b4')
STAFF(2).remove_supline({top:1})
acc.note(5).hide()
WAIT(1)
acc.chord('G')
WAIT(1)
acc.cadence('I', {width:100, type:imparfaite})
acc.note(5).show()
acc.note(1).move('b3')
NOTE('d4')

# --- Mesure 8 : C7M ---
NEXT()
STAFF(1).measure('8')
partition.move({x:596}).travelling({x:1209})
acc = CHORD('2:b3 2:c4 e4 g4 c5')
acc.note(5).hide()
acc.note(1).move('1:b4')
acc.note(2).move('1:c4')
STAFF(2).remove_supline({top:1})
WAIT(1)
acc.chord('C7M')
WAIT(1)
acc.harmony('IV7M***')
WAIT(1)
acc.note(1).move(b3)
WAIT(1)
acc.note(5).show()

# --- Mesure 9 : Am7 ---
NEXT()
STAFF(1).measure('9')
partition.travelling({x:1366})
acc = CHORD('2:a3 2:c4 e4 g4 c5')
acc.note(5).hide()
WAIT(1)
acc.chord('Am7')
WAIT(1)
acc.note(5).show()
acc.note(1).move('1:a3')
acc.note(2).move('1:c4')
STAFF(2).remove_suplines({top:[1,2]})
WAIT(1)
acc.harmony('II7*')

# --- Mesure 10 : D7 ---
NEXT()
STAFF(1).measure('10')
partition.travelling({x:1536})
acc = CHORD('2:d3 2:a3 d4 fd4 c5')
WAIT(1)
acc.note(1).remove()
acc.note(2).move('1:a4')
WAIT(1)
acc.chord('D7')
WAIT(1)
acc.harmony('V7')

# --- Mesure 11 : G ---
# NOTER ICI QUE C'EST LE MÊME 
# QUE L'ACCORD I AU DÉPART
NEXT()
STAFF(1).measure('11')
partition.travelling({x:1684})
acc = CHORD('2:g3 2:b3 d4 g4 b4')
acc.note(5).hide()
acc.note(4).hide()
acc.note(1).move('1:g3')
acc.note(2).move('1:b3')
acc.chord('G')
WAIT(2)
acc.cadence('I', {width:200, type_cadence:parfaite})
acc.note(5).show()
acc.note(4).show()
WAIT(4)
CAPTION("On vient d'atteindre un “bout”, avec cette conclusion à la dominante.")
