<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/philippeperret/Sites/staves/javascript/Graphic/ImageTool.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Anim.html">Anim</a></li>
            
                <li><a href="../classes/Anim.Cursor.html">Anim.Cursor</a></li>
            
                <li><a href="../classes/Anim.Dom.html">Anim.Dom</a></li>
            
                <li><a href="../classes/Anim.Grid.html">Anim.Grid</a></li>
            
                <li><a href="../classes/Anim.Objects.html">Anim.Objects</a></li>
            
                <li><a href="../classes/Anim.options.html">Anim.options</a></li>
            
                <li><a href="../classes/Arrow.html">Arrow</a></li>
            
                <li><a href="../classes/Chord.html">Chord</a></li>
            
                <li><a href="../classes/Circle.html">Circle</a></li>
            
                <li><a href="../classes/Console.html">Console</a></li>
            
                <li><a href="../classes/Courbe.html">Courbe</a></li>
            
                <li><a href="../classes/Doublage.html">Doublage</a></li>
            
                <li><a href="../classes/ImageTool.html">ImageTool</a></li>
            
                <li><a href="../classes/Img.html">Img</a></li>
            
                <li><a href="../classes/Infos.html">Infos</a></li>
            
                <li><a href="../classes/Motif.html">Motif</a></li>
            
                <li><a href="../classes/Note.html">Note</a></li>
            
                <li><a href="../classes/OBJET_TRAITEMENT.html">OBJET_TRAITEMENT</a></li>
            
                <li><a href="../classes/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../classes/options.html">options</a></li>
            
                <li><a href="../classes/Pas.html">Pas</a></li>
            
                <li><a href="../classes/Regle.html">Regle</a></li>
            
                <li><a href="../classes/Scale.html">Scale</a></li>
            
                <li><a href="../classes/Staff.html">Staff</a></li>
            
                <li><a href="../classes/Step.html">Step</a></li>
            
                <li><a href="../classes/tools.html">tools</a></li>
            
                <li><a href="../classes/Txt.html">Txt</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/UI.Popups.html">UI.Popups</a></li>
            
                <li><a href="../classes/UI.Popups.Methods.html">UI.Popups.Methods</a></li>
            
                <li><a href="../classes/UI.Tools.html">UI.Tools</a></li>
            
                <li><a href="../classes/window.html">window</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Anim.html">Anim</a></li>
            
                <li><a href="../modules/Anim_Cursor
Gestion du curseur de position de l&#x27;animation.html">Anim_Cursor
Gestion du curseur de position de l&#x27;animation</a></li>
            
                <li><a href="../modules/Anim_Dom.js.html">Anim_Dom.js</a></li>
            
                <li><a href="../modules/Anim_Grid.html">Anim_Grid</a></li>
            
                <li><a href="../modules/Anim_infos.html">Anim_infos</a></li>
            
                <li><a href="../modules/Anim_Objects.js.html">Anim_Objects.js</a></li>
            
                <li><a href="../modules/Anim_Step.html">Anim_Step</a></li>
            
                <li><a href="../modules/Arrow.js.html">Arrow.js</a></li>
            
                <li><a href="../modules/Chord.js.html">Chord.js</a></li>
            
                <li><a href="../modules/Circle.js.html">Circle.js</a></li>
            
                <li><a href="../modules/Console.js.html">Console.js</a></li>
            
                <li><a href="../modules/constantes.html">constantes</a></li>
            
                <li><a href="../modules/Controller.js.html">Controller.js</a></li>
            
                <li><a href="../modules/Courbe.js.html">Courbe.js</a></li>
            
                <li><a href="../modules/Doublage.js.html">Doublage.js</a></li>
            
                <li><a href="../modules/Event.js
Gestion des évènements.html">Event.js
Gestion des évènements</a></li>
            
                <li><a href="../modules/GroupNotes.js.html">GroupNotes.js</a></li>
            
                <li><a href="../modules/handy.js.html">handy.js</a></li>
            
                <li><a href="../modules/Image.js.html">Image.js</a></li>
            
                <li><a href="../modules/ImageTool.js.html">ImageTool.js</a></li>
            
                <li><a href="../modules/Motif.js.html">Motif.js</a></li>
            
                <li><a href="../modules/Note.html">Note</a></li>
            
                <li><a href="../modules/Pas.js.html">Pas.js</a></li>
            
                <li><a href="../modules/Scale.js.html">Scale.js</a></li>
            
                <li><a href="../modules/Staff.html">Staff</a></li>
            
                <li><a href="../modules/Texte.js.html">Texte.js</a></li>
            
                <li><a href="../modules/Txt.js.html">Txt.js</a></li>
            
                <li><a href="../modules/UI.js.html">UI.js</a></li>
            
                <li><a href="../modules/UI.Popups.html">UI.Popups</a></li>
            
                <li><a href="../modules/UI.Regle.js.html">UI.Regle.js</a></li>
            
                <li><a href="../modules/UI.Tools.js.html">UI.Tools.js</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /Users/philippeperret/Sites/staves/javascript/Graphic/ImageTool.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
  * @module ImageTool.js
  */

/**
  * Objet pour la gestion des images.
  * Principalement, il doit permettre de définir, dans une image comme une partition
  * par exemple, la portion à afficher (en utilisant l&#x27;image en background d&#x27;un div
  * et en jouant sur le positionnement, ou simplement en utilisant des left/top
  * appropriés — négatifs — et des overflow hidden ?)
  * @class ImageTool
  * @static
  */
window.ImageTool = {
  /**
    * Instance de l&#x27;image éditée
    * @property {Img} current
    */
  current:null,

  /**
    * Données de l&#x27;image en cours d&#x27;édition
    * Note : L&#x27;objet est renseigné en début de processus par les 
    * méthodes &#x60;this.set_data_image&#x60; et &#x60;this.get_taille_image&#x60;
    * @property {Object} data_image
    * @default NULL
    */
  data_image:null,
  
  /**
    * Méthode qui définit les données de base de l&#x27;image
    * La méthode renseigne la propriété &#x60;this.data_image&#x60;
    * @method set_data_image
    */
  set_data_image:function()
  {
    this.data_image = {
      cadre_offset_x  : this.current.cadre_offset_x, // recadrage horizontal
      cadre_offset_y  : this.current.cadre_offset_y, // recadrage vertical
      cadre_width     : this.current.cadre_width,
      cadre_height    : this.current.cadre_height,
      src             : this.current.url
    }
  },
  /**
    * Définit la taille de l&#x27;image (éditée) à l&#x27;écran
    * La méthode renseigne l&#x27;objet this.data_image
    * @method get_taille_image
    */
  get_taille_image:function()
  {
    $.extend(this.data_image,{
      width_init      : this.image.width(),
      width           : this.image.width(),
      height_init     : this.image.height(),
      height          : this.image.height(),
    })
  },
  /**
    * == Main ==
    *
    * Mise en édition de l&#x27;image de source +src+
    * 
    * @method edit
    * @param {String} image     Instance de l&#x27;image éditée
    * @param {Object} params    Paramètres optionnels
    */
  edit:function(image, params)
  {
    this.current = image
    this.set_data_image()
    if(this.gabarit.length == 0) this.prepare()
    else
    {
      this.gabarit.show()
      this.image.replaceWith(this.html_image)
      this.set_cadre_properties()
    } 
    this.get_taille_image()
    this.box_feedback.val(&#x27;&#x27;)
    this.box_feedback_alt.val(&#x27;&#x27;)
  },
  
  end_edit:function()
  {
    this.gabarit.hide()
  },
  
  /**
    * Définit le code pour obtenir le réglage courant
    * La méthode donne le code à utiliser dans l&#x27;animation
    * @method params_image
    */
  params_image:function()
  {
    // Rappel : l&#x27;image est placée à 10px * 10px des bords
    // Il faut prendre la position du recadrage
    this.calcul_recadrage()
    var code = &#x27;{&#x27;+
              &#x27;url:\&#x27;&#x27;  +this.data_image.src+&#x27;\&#x27;, &#x27;+
              &#x27;top:&#x27;    +this.current.top+&#x27;, &#x27;+
              &#x27;left:&#x27;   +this.current.left+&#x27;, &#x27;+
              &#x27;width:&#x27;  +this.data_image.width+&#x27;, &#x27;+
              &#x27;height:&#x27; +this.data_image.height+&#x27;, &#x27;+
              &#x27;cadre_offset_x:&#x27; +this.data_image.cadre_offset_x+&#x27;, &#x27;+
              &#x27;cadre_offset_y:&#x27; +this.data_image.cadre_offset_y+&#x27;, &#x27;+
              &#x27;cadre_width:&#x27;    +this.data_image.cadre_width+&#x27;, &#x27;+
              &#x27;cadre_height:&#x27;   +this.data_image.cadre_height +
            &#x27;}&#x27;
    this.box_feedback.val(code)
    
    code = [];
    if(this.current.cadre_offset_x != this.data_image.cadre_offset_x)
      code.push(&#x27;x:&#x27; +this.data_image.cadre_offset_x);
    if(this.current.cadre_offset_y != this.data_image.cadre_offset_y)
      code.push(&#x27;y:&#x27; +this.data_image.cadre_offset_y) ;
    if(this.current.cadre_width != this.data_image.cadre_width)
      code.push(&#x27;width:&#x27;+this.data_image.cadre_width);
    if(this.current.cadre_height != this.data_image.cadre_height)
      code.push(&#x27;height:&#x27;+this.data_image.cadre_height);
    code = &#x27;{&#x27;+code.join(&#x27;, &#x27;)+&#x27;}&#x27;
    this.box_feedback_alt.val(code)
  },
  /**
    * Méthode qui calcule le recadrage de l&#x27;image en fonction de la position
    * du cadre rouge.
    * Elle renseigne les propriétés &#x60;offset_x&#x60; et &#x60;offset_y&#x60; de &#x60;data_image&#x60;
    * @method calcul_recadrage
    */
  calcul_recadrage:function()
  {
    var pos = this.box_cadre.position()
    this.data_image.cadre_offset_x = pos.left - 10 // car image placée à 10px
    this.data_image.cadre_offset_y = pos.top  - 10 // car image placée à 10px
    this.data_image.cadre_width   = this.box_cadre.width()
    this.data_image.cadre_height  = this.box_cadre.height()
  },
  /**
    * Diminuer la taille de l&#x27;image
    * @method image_smaller
    * @param {Event} evt Evènement (pour savoir si des modifiers sont pressés)
    */
  image_smaller:function(evt)
  {
    var inc = 10
    this.data_image.width  -= inc
    this.data_image.height -= inc
    this.set_image_properties()
  },
  /**
    * Augmenter la taille de l&#x27;image
    * @method image_bigger
    * @param {Event} evt Evènement (pour savoir si des modifiers sont pressés)
    */
  image_bigger:function(evt)
  {
    var inc = 10
    this.data_image.width  += inc
    this.data_image.height += inc
    this.set_image_properties()
  },
  /**
    * Définit les propriétés du cadrage (sa position et sa taille)  
    * @method set_cadre_properties
    */
  set_cadre_properties:function()
  {
    this.box_cadre.css({
      width   :this.data_image.cadre_width+&#x27;px&#x27;,
      height  :this.data_image.cadre_height+&#x27;px&#x27;,
      top     :(this.data_image.cadre_offset_y+10)+&#x27;px&#x27;,
      left    :(this.data_image.cadre_offset_x+10)+&#x27;px&#x27;
    })
  },
  /**
    * Redéfinit les propriétés de l&#x27;image éditée à l&#x27;affichage
    * @method set_image_properties
    */
  set_image_properties:function()
  {
    this.image.css({
      width   :this.data_image.width+&#x27;px&#x27;,
      height  :this.data_image.height+&#x27;px&#x27;
    })
  },
  /**
    * Prépare les éléments DOM des outils image
    * @method prepare
    */
  prepare:function()
  {
    $(&#x27;body&#x27;).append(&#x27;&lt;div id=&quot;imgtool_gabarit&quot;&gt;&lt;/div&gt;&#x27;)
    this.gabarit.append(this.html_code_boutons)
    this.gabarit.append(this.html_image)
    this.gabarit.append(this.html_cadre)
    this.set_cadre_properties()
    $(&#x27;div#in_recadrage&#x27;).bind(&#x27;mousedown&#x27;,function(){$(&#x27;div#recadrage&#x27;).draggable()})
    $(&#x27;div#in_recadrage&#x27;).bind(&#x27;mouseup&#x27;,function(){$(&#x27;div#recadrage&#x27;).draggable(&quot;destroy&quot;)})
  }
}
Object.defineProperties(ImageTool,{
  
  /**
    * Objet DOM du gabarit général
    * @property {jQuerySet} gabarit
    */
  &quot;gabarit&quot;:{
    get:function(){return $(&#x27;div#imgtool_gabarit&#x27;)}
  },
  /**
    * Objet DOM de la boite de recadrage
    * @property {jQuerySet} box_cadre
    */
  &quot;box_cadre&quot;:{
    get:function(){return $(&#x27;div#recadrage&#x27;)}
  },
  /**
    * Objet DOM de l&#x27;image éditée
    * @property {jQuerySet} image
    */
  &quot;image&quot;:{
    get:function(){return $(&#x27;img#imgtool_image&#x27;)}
  },
  /**
    * Objet DOM du textarea pour placer le code à copier-coller
    * @property {jQuerySet} box_feedback
    */
  &quot;box_feedback&quot;:{
    get:function(){return $(&#x27;textarea#imgtool_feedback&#x27;)}
  },
  /**
    * Objet DOM du textarea pour placer les paramètres travelling
    * @property {jQuerySet} box_feedback_alt
    */
  &quot;box_feedback_alt&quot;:{
    get:function(){return $(&#x27;textarea#imgtool_feedback_alt&#x27;)}
  },
  
  /**
    * Code HTML pour l&#x27;image
    * @property {HTMLString} html_image
    */
  &quot;html_image&quot;:{
    get:function(){
      var style = [], cur = this.current
      if(cur.width)   style.push(&#x27;width:&#x27;+cur.width+&#x27;px&#x27;)
      if(cur.height)  style.push(&#x27;height:&#x27;+cur.height+&#x27;px&#x27;)
      return &#x27;&lt;img id=&quot;imgtool_image&quot; src=&quot;&#x27;+cur.url+&#x27;&quot; style=&quot;&#x27;+style.join(&#x27;;&#x27;)+&#x27;&quot; /&gt;&#x27;
    }
  },
  /**
    * Code HTML pour le div du cadre
    * Note :  Aucun réglage de taille ou de position n&#x27;est effectué ici,
    *         c&#x27;est la méthode &#x60;set_cadre_properties&#x60; qui s&#x27;en charge
    * @property {HTMLString} html_cadre
    */
  &quot;html_cadre&quot;:{
    get:function(){
      return &#x27;&lt;div id=&quot;recadrage&quot;&gt;&lt;div id=&quot;in_recadrage&quot;&gt;&lt;/div&gt;&lt;/div&gt;&#x27;
    }
  },
  /**
    * Code HTML pour les boutons
    * @property {String} html_code_boutons
    */
  &quot;html_code_boutons&quot;:{
    get:function(){
      return  &#x27;&lt;div class=&quot;buttons&quot;&gt;&#x27;+
                &#x27;&lt;fieldset&gt;&lt;legend&gt;Taille image&lt;/legend&gt;&#x27; +
                  &#x27;&lt;input type=&quot;button&quot; value=&quot; + &quot; onclick=&quot;$.proxy(ImageTool.image_bigger, ImageTool, event)()&quot; /&gt;&#x27;+
                  &#x27;&lt;input type=&quot;button&quot; value=&quot; - &quot; onclick=&quot;$.proxy(ImageTool.image_smaller, ImageTool, event)()&quot; /&gt;&#x27;+
                &#x27;&lt;/fieldset&gt;&#x27;+
                &#x27;&lt;div class=&quot;tiny&quot;&gt;Code à copier-coller dans les paramètres de l\&#x27;image&lt;/div&gt;&#x27;+
                &#x27;&lt;textarea id=&quot;imgtool_feedback&quot; onfocus=&quot;this.select()&quot;&gt;&lt;/textarea&gt;&#x27;+
                &#x27;&lt;div class=&quot;tiny&quot;&gt;Paramètres pour travelling&lt;/div&gt;&#x27;+
                &#x27;&lt;textarea id=&quot;imgtool_feedback_alt&quot; onfocus=&quot;this.select()&quot;&gt;&lt;/textarea&gt;&#x27;+
                &#x27;&lt;div class=&quot;right&quot;&gt;&#x27;+
                  &#x27;&lt;input type=&quot;button&quot; value=&quot;-&gt; Code&quot; onclick=&quot;$.proxy(ImageTool.params_image, ImageTool)()&quot; /&gt;&#x27;+
                  &#x27;&lt;input type=&quot;button&quot; value=&quot;OK&quot; onclick=&quot;$.proxy(ImageTool.end_edit, ImageTool)()&quot; /&gt;&#x27;+
                &#x27;&lt;/div&gt;&#x27;+
              &#x27;&lt;/div&gt;&#x27;
      
    }
  }
  
})
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
