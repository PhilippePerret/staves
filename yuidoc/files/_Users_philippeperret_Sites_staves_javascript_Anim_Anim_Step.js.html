<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>/Users/philippeperret/Sites/staves/javascript/Anim/Anim_Step.js</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Anim.html">Anim</a></li>
            
                <li><a href="../classes/Anim.Dom.html">Anim.Dom</a></li>
            
                <li><a href="../classes/Arrow.html">Arrow</a></li>
            
                <li><a href="../classes/Chord.html">Chord</a></li>
            
                <li><a href="../classes/Circle.html">Circle</a></li>
            
                <li><a href="../classes/Console.html">Console</a></li>
            
                <li><a href="../classes/Courbe.html">Courbe</a></li>
            
                <li><a href="../classes/GROUPNOTES_METHODS METHODES_GROUPNOTES.html">GROUPNOTES_METHODS METHODES_GROUPNOTES</a></li>
            
                <li><a href="../classes/Note.html">Note</a></li>
            
                <li><a href="../classes/ObjetClass.html">ObjetClass</a></li>
            
                <li><a href="../classes/Objets.html">Objets</a></li>
            
                <li><a href="../classes/Scale.html">Scale</a></li>
            
                <li><a href="../classes/Staff.html">Staff</a></li>
            
                <li><a href="../classes/Step.html">Step</a></li>
            
                <li><a href="../classes/Txt.html">Txt</a></li>
            
                <li><a href="../classes/UI.html">UI</a></li>
            
                <li><a href="../classes/window.html">window</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/Anim.html">Anim</a></li>
            
                <li><a href="../modules/Anim_Dom.js.html">Anim_Dom.js</a></li>
            
                <li><a href="../modules/Anim_Objects.js.html">Anim_Objects.js</a></li>
            
                <li><a href="../modules/Anim_Step.html">Anim_Step</a></li>
            
                <li><a href="../modules/Arrow.js.html">Arrow.js</a></li>
            
                <li><a href="../modules/Chord.js.html">Chord.js</a></li>
            
                <li><a href="../modules/Circle.js.html">Circle.js</a></li>
            
                <li><a href="../modules/Console.js.html">Console.js</a></li>
            
                <li><a href="../modules/constantes.html">constantes</a></li>
            
                <li><a href="../modules/Controller.js.html">Controller.js</a></li>
            
                <li><a href="../modules/Courbe.js.html">Courbe.js</a></li>
            
                <li><a href="../modules/Note.html">Note</a></li>
            
                <li><a href="../modules/Scale.js.html">Scale.js</a></li>
            
                <li><a href="../modules/Staff.html">Staff</a></li>
            
                <li><a href="../modules/Txt.js.html">Txt.js</a></li>
            
                <li><a href="../modules/UI.js.html">UI.js</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: /Users/philippeperret/Sites/staves/javascript/Anim/Anim_Step.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
  * Pour tout ce qui concerne un pas, une étape de l&#x27;animation
  *
  * Notes
  * -----
  *   * C&#x27;est au bout de ce fichier qu&#x27;est défini NEXT_STEP
  *
  * @module Anim_Step
  */

/**
  * @class Step
  * @for Anim
  * @static
  */
if(undefined == window.Anim) window.Anim = {}
Anim.Step = {
  /**
    * Liste de toutes les étapes (code de console splitter par les retours-chariot)
    * @property {Array} list
    * @default null
    */
  list:null,
  
  /**
    * Étape courante (texte string de la console, sans le retour chariot)
    * @property {String} current
    */
  current:null,
  
  /**
    * Joue l&#x27;étape (évalue son code)
    * Notes
    * -----
    *   * Pour le moment, la méthode prend le code dans Anim.Step.current
    *     TODO: Mais plus tard, ce code devrai être géré dans ce Anim.Step
    *   * Un timer peut avoir été défini (si Anim.transition.step est ≠ 0)
    *   * Le bloc &#x27;try&#x27; a une double fonction ici : en mode normal, il génère
    *     une erreur mais poursuit le code. En mode flash, il peut arriver que
    *     ça aille trop vite pour les éléments soient affichés, donc on fait 
    *     une courte pause avant de ré-évaluer l&#x27;étape. On essaie un maximum de
    *     3 fois puis on abandonne.
    * @method run
    */
  run:function()
  {
    // dlog(&quot;-&gt; Anim.Step.run / Anim.Step.current:&quot;+this.current)
    try
    {
      // dlog(&quot;run:this.Objects.&quot;+this.current)
      eval(&#x27;Anim.Objects.&#x27;+this.current)
      // dlog(&quot;run OK&quot;)
    }
    catch(err)
    {
      if(MODE_FLASH)
      {
        if(this.nombre_essais_run &amp;&amp; this.nombre_essais_run &gt; 2)
        {
          errMess = &quot;# J&#x27;ai essayé de jouer 3 fois le code &#x60;this.Objects.&quot;+this.current+&quot;&#x60; en vain. Je poursuis, sans bien être sûr du résultat produit…&quot;
          F.error(errMess)
          dlog(&quot;#ERROR# &quot;+ errMess)
        }
        else
        {
          if(undefined == this.nombre_essais_run) this.nombre_essais_run = 0
          ++ this.nombre_essais_run
          dlog(&quot;this.nombre_essais_run=&quot;+this.nombre_essais_run)
          if(this.timer_essais_run) clearTimeout(this.timer_essais_run)
          this.timer_essais_run = setTimeout($.proxy(this.run, this), 500)
          return
        }
      }
      else // mode non flash (normal)
      {
        errMess = &quot;# Erreur: &quot;+err+ &quot; survenue avec le code &#x60;this.Objects.&quot;+this.current+&quot;. Mais j&#x27;essaie de poursuivre.&quot;
        F.error(errMess)
        dlog(&quot;#ERROR# &quot;+errMess)
      }
      NEXT_STEP()
    }
    // S&#x27;il y a eu plusieurs essais en mode flash
    if(this.timer_essais_run)
    {
      clearTimeout(this.timer_essais_run)
      delete this.nombre_essais_run
    }
  },
  /**
    * Méthode qui joue la séquence suivante
    * @method next
    */
  next:function()
  {
    if(this.timer) clearTimeout(this.timer)
    if(!this.list) return Anim.stop()
    this.set_current()
    // Passer les commentaires
    if(this.current.substring(0,1) == &quot;#&quot;) return this.next()
    /* === On joue l&#x27;étape === */
    this.run()
    if(!this.list || this.list.length == 0) Anim.stop()
  },
  /**
    * Définit l&#x27;étape courante
    * PRODUIT
    * -------
    *   * Définit la propriété &#x60;current&#x60; (Anim.Step.current)
    *   * Sélectionne la portion de code dans la console
    *
    * @method set_current
    */
  set_current:function()
  {
    // On prend le code tel quel pour pouvoir gérer la sélection du code
    this.current = this.list.shift()
    Console.move_cursor({for:this.current.length + 1})
    this.current = this.current.trim() // =&gt; le texte épuré de l&#x27;étape
  },
  
  /**
    * Passe à l&#x27;étape suivante, mais seulement si le mode pas à pas n&#x27;est
    * pas enclenché.
    * NOTES
    * -----
    *   * Si Anim.transition.step est défini, et que +no_timeout+ n&#x27;est pas true,
    *     alors il faut appeler next() seulement après le délai spécifié
    *
    * @method auto_next
    * @param  {Boolean} no_timeout Si true, pas de délai avant d&#x27;appeler l&#x27;étape suivante
    */
  auto_next:function(no_timeout)
  {
    if(Anim.timer) clearTimeout(Anim.timer)
    if(this.MODE_PAS_A_PAS) return
    if(MODE_FLASH || no_timeout || Anim.transition.step == 0)
    {
      this.next()
    }
    else
    {
      Anim.timer = setTimeout($.proxy(Anim.Step.next, Anim.Step), Anim.transition.step)
    }
  }
  
}

/**
  * Raccourci pour définir de passer à l&#x27;étape suivante
  * @for window
  * @property NEXT_STEP
  * @static
  * @final
  */
var NEXT_STEP = $.proxy(Anim.Step.auto_next, Anim.Step)
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
